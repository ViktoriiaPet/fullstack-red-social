<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creación de un grupo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" crossorigin="anonymous">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h1 class="mb-4">Crear grupo</h1>
        <form id="createGroupForm">
            <div class="mb-3">
                <label for="groupname" class="form-label">Nombre del grupo</label>
                <input type="text" class="form-control" id="groupname" required>
            </div>
            <div class="mb-3">
                <label for="groupcode" class="form-label">Código autogenerado del grupo</label>
                <input type="text" class="form-control" id="groupcode" readonly placeholder="Se generará automáticamente">
            </div>
            <div class="mb-3">
                <label for="inviteSearch" class="form-label">Invitar a un usuario: </label>
                <div class="d-flex">
                    <input type="email" class="form-control" id="email" placeholder="Introduce un correo">
                    <button type="button" class="btn btn-primary ml-2">Buscar</button>
                </div>
            </div>
            <div class="mb-3 mt-3">
                <button type="submit" class="btn btn-success">Crear grupo</button>
            </div>
            <hr>
        </form>

        <h2 class="mb-4">Unirse a un grupo</h2>
        <form id="joinGroupForm">
            <div class="mb-3">
                <label for="joinCode" class="form-label">Código de invitación</label>
                <input type="text" class="form-control mb-3" id="joinCode" required>
                <button type="submit" class="btn btn-primary">Enviar</button>
            </div>
        </form>
    </div>

    <script>
        // -------------------- PSEUDO DB --------------------
        let groupsDB = JSON.parse(localStorage.getItem("groupsDB")) || [];

        // Generador de código aleatorio (6 caracteres)
        function generateCode() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            return Array.from({ length: 6 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        // Evento para crear grupo
        document.getElementById("createGroupForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const code = generateCode();
            document.getElementById("groupcode").value = code;

            const newGroup = {
                id: Date.now(),
                name: document.getElementById("groupname").value,
                code: code,
                invitedEmail: document.getElementById("email").value || "Ninguno"
            };

            groupsDB.push(newGroup);
            localStorage.setItem("groupsDB", JSON.stringify(groupsDB));

            window.open("groupsData.html", "_blank");
        });

        // Evento para unirse a grupo
        document.getElementById("joinGroupForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const joinCode = document.getElementById("joinCode").value.trim();
            const groups = JSON.parse(localStorage.getItem("groupsDB")) || [];
            const groupFound = groups.find(g => g.code === joinCode);

            if (groupFound) {
                alert(`Te has unido al grupo "${groupFound.name}" (${groupFound.code})`);
            } else {
                alert("Código inválido o grupo no encontrado.");
            }
        });
    </script>
</body>
</html>